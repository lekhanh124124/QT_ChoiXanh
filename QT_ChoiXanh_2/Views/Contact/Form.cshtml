@{
    ViewData["Title"] = "Quản lý liên hệ";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="content-header">
    <h1>QUẢN LÝ LIÊN HỆ</h1>
</section>

<section class="content">
    <div class="khung">
        <div class="right">
            Giảm bớt cột:
            <a class="toggle-vis btn btn-xs btn-info" data-column="0">ID</a>
            <a class="toggle-vis btn btn-xs btn-default" data-column="1">Người liên hệ</a>
            <a class="toggle-vis btn btn-xs btn-primary" data-column="2">Thời gian</a>
            <a class="toggle-vis btn btn-xs btn-warning" data-column="3">IP</a>
            <a class="toggle-vis btn btn-xs btn-danger" data-column="4">Chức năng</a>
        </div>
        <table id="lienhe" class="display" style="width: 100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Người liên hệ</th>
                    <th>Thời gian</th>
                    <th>IP</th>
                    <th>Chức năng</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Disable jQuery cache globally for this page to prevent _ parameter
            $.ajaxSetup({
                cache: false
            });
            
            var table = $('#lienhe').DataTable({
                "ajax": {
                    "url": "https://localhost:44321/api/Generic/Table_Customer_Contact/filter?page=1&pageSize=100",
                    "type": "GET",
                    "dataSrc": "",
                    "cache": false,
                    "beforeSend": function(xhr, settings) {
                        // Remove any cache-busting parameter that might be added
                        settings.url = settings.url.replace(/[?&]_=\d+/, '');
                        return true;
                    }
                },
                "columns": [
                    { "data": "AutoID" },
                    { "data": "CustomerName" },
                    {
                        "data": "DateTime",
                        "render": function (data, type, row) {
                            if (type === 'display' || type === 'filter') {
                                return moment(data).format('DD/MM/YYYY HH:mm:ss');
                            }
                            return moment(data).valueOf();
                        }
                    },
                    { "data": "Remote_Add" },
                    {
                        "data": "AutoID",
                        "render": function (data, type, row) {
                            var id = row.AutoID;
                            return `<a href="edit.asp?act=3&gdc=3&AutoID=${id}" title="Xem liên hệ" class="btn btn-xs btn-success"><i class="fa fa-eye"></i> Xem</a>
                                    <a href="delete.asp?act=3&gdc=3&AutoID=${id}" title="Xóa liên hệ" class="btn btn-xs btn-danger"><i class="fa fa-trash"></i> Xóa</a>`;
                        }
                    }
                ],
                "order": [[2, "desc"]],
                "responsive": true,
                "pageLength": 100,
                "searching": true,
                "ordering": true,
                "colReorder": true,
                "language": {
                    "lengthMenu": "Hiển thị _MENU_ kết quả",
                    "info": "Hiển thị _START_ đến _END_ [_TOTAL_]",
                    "processing": "Đang xử lý dữ liệu...",
                    "emptyTable": "Không có dữ liệu",
                    "paginate": {
                        "previous": "Trước",
                        "next": "Kế"
                    }
                }
            });

            // Xử lý bật/tắt cột
            $('.toggle-vis').on('click', function (e) {
                e.preventDefault();
                var column = table.column($(this).attr('data-column'));
                column.visible(!column.visible());
            });
        });
    </script>
}
